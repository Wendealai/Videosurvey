<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客户需求调查问卷（医院科室宣传微视频）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* 自定义样式以更好地匹配设计要求 */
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background-color: #f8f9fa;
        }
        .main-title {
            color: #FF8C00;
        }
        .accent-color {
            color: #FF8C00;
        }
        .accent-bg {
            background-color: #FF8C00;
        }
        .accent-border {
            border-color: #FF8C00;
        }
        .quote-block {
            border-left: 4px solid #FF8C00;
        }
        .form-section-title svg {
            color: #FF8C00;
        }
        .tag {
            background-color: #FF8C00;
            color: white;
        }
        /* 自定义输入框样式 */
        .form-input, .form-textarea, .form-select {
            border: 1px solid #d1d5db;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            min-height: 44px;
            resize: vertical;
            text-align: left;
        }
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: #FF8C00;
            box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.2);
            outline: none;
        }
        /* 自定义单选/复选框样式 */
        .form-radio, .form-checkbox {
            color: #FF8C00;
        }
        .form-radio:checked, .form-checkbox:checked {
            background-color: #FF8C00;
        }
        .form-radio:focus, .form-checkbox:focus {
             box-shadow: 0 0 0 2px rgba(255, 140, 0, 0.2);
        }
        
        /* 加载状态样式 */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .submit-button:disabled {
            background-color: #ccc !important;
            cursor: not-allowed;
        }
        
        /* 加载动画 */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 relative">
        <!-- Logo -->
        <div class="absolute top-20 right-4 bg-white p-3 rounded-lg shadow-sm z-10">
            <img src="logo.png" alt="天润传媒" class="h-16 w-auto">
        </div>

        <!-- 顶部信息 -->
        <header class="mb-10 pt-16">
            <h1 class="text-3xl md:text-4xl font-bold main-title mb-2">客户需求调查问卷</h1>
            <p class="text-gray-500">医院科室宣传微视频项目</p>
            <div class="mt-4 flex flex-wrap gap-x-8 gap-y-4 text-sm text-gray-600">
                <div class="flex items-center">
                    <span class="w-2 h-2 rounded-full accent-bg mr-2"></span>
                    <span>日期: <span id="current-date"></span></span>
                </div>
                <div class="flex items-center">
                    <span class="w-2 h-2 rounded-full accent-bg mr-2"></span>
                    <span>问卷版本: <span class="font-semibold accent-color">v1.2</span></span>
                </div>
                <div class="flex items-center">
                    <span class="w-2 h-2 rounded-full accent-bg mr-2"></span>
                    <span>预计填写时长: <span class="font-semibold accent-color">15分钟</span></span>
                </div>
            </div>
        </header>

        <div class="space-y-12">
            <!-- 主体内容：问卷表单 -->
            <main class="w-full">
                <form id="survey-form" class="space-y-12" netlify action="/success.html">
                    <!-- Netlify Forms 隐藏字段 -->
                    <input type="hidden" name="form-name" value="survey-form" />
                    
                    <!-- 第一部分：科室背景与基础信息 -->
                    <section>
                        <h2 class="form-section-title text-2xl font-bold mb-6 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                            第一部分：科室背景与基础信息
                        </h2>
                        <div class="space-y-6 bg-white p-6 rounded-lg shadow-sm">
                            <div>
                                <label for="q1" class="block text-md font-medium text-gray-700 mb-2">1. 请介绍贵科室的历史沿革（成立时间、发展阶段、重要里程碑）。</label>
                                <textarea id="q1" name="history" rows="4" class="form-textarea w-full p-3 rounded-md"></textarea>
                                <p class="text-sm text-gray-500 mt-1 italic">*案例提示：例如某医院神经内科在 2005 年成立，2015 年成为自治区重点学科。</p>
                            </div>
                            <div>
                                <label for="q2" class="block text-md font-medium text-gray-700 mb-2">2. 目前科室的人员规模与构成（医生、护士、科研人员比例，核心专家介绍）。</label>
                                <textarea id="q2" name="team_structure" rows="4" class="form-textarea w-full p-3 rounded-md"></textarea>
                            </div>
                            <div>
                                <label for="q3" class="block text-md font-medium text-gray-700 mb-2">3. 科室在近 5 年内取得过哪些主要荣誉或成果？</label>
                                <textarea id="q3" name="achievements" rows="4" class="form-textarea w-full p-3 rounded-md"></textarea>
                                <p class="text-sm text-gray-500 mt-1 italic">*案例提示：国家级科研奖项、自治区先进集体、学术论文发表等。</p>
                            </div>
                            <div>
                                <label for="q4" class="block text-md font-medium text-gray-700 mb-2">4. 您认为最能代表科室特色或优势的三点是什么？</label>
                                <input type="text" id="q4" name="advantages" class="form-input w-full p-3 rounded-md">
                            </div>
                        </div>
                    </section>
                    
                    <!-- 第二部分：宣传目标与诉求 -->
                    <section>
                         <h2 class="form-section-title text-2xl font-bold mb-6 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                            第二部分：宣传目标与诉求
                        </h2>
                        <div class="space-y-6 bg-white p-6 rounded-lg shadow-sm">
                            <div>
                                <label for="q5" class="block text-md font-medium text-gray-700 mb-2">1. 您希望通过本次微视频传达的核心信息是什么？</label>
                                <input type="text" id="q5" name="core_message" class="form-input w-full p-3 rounded-md">
                                <p class="text-sm text-gray-500 mt-1 italic">*案例提示：突出科室专业实力、展示医患关系温情、提升社会公众认知。</p>
                            </div>
                            <div>
                                <label class="block text-md font-medium text-gray-700 mb-2">2. 本次视频的目标受众主要是哪些群体？</label>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <label class="flex items-center"><input type="checkbox" name="audience" value="internal_staff" class="form-checkbox h-4 w-4 rounded mr-2"><span class="text-sm">院内职工</span></label>
                                    <label class="flex items-center"><input type="checkbox" name="audience" value="patients" class="form-checkbox h-4 w-4 rounded mr-2"><span class="text-sm">患者及家属</span></label>
                                    <label class="flex items-center"><input type="checkbox" name="audience" value="public" class="form-checkbox h-4 w-4 rounded mr-2"><span class="text-sm">社会公众</span></label>
                                    <label class="flex items-center"><input type="checkbox" name="audience" value="experts" class="form-checkbox h-4 w-4 rounded mr-2"><span class="text-sm">评审专家</span></label>
                                </div>
                            </div>
                             <div>
                                <label for="q6" class="block text-md font-medium text-gray-700 mb-2">3. 短期目标和长期目标分别是什么？</label>
                                <textarea id="q6" name="goals" rows="4" class="form-textarea w-full p-3 rounded-md" placeholder="例如：短期参赛获奖，长期品牌沉淀..."></textarea>
                            </div>
                             <div>
                                <label for="q7" class="block text-md font-medium text-gray-700 mb-2">4. 您希望观众在观看视频后产生什么样的情感或认知？</label>
                                <input type="text" id="q7" name="viewer_reaction" class="form-input w-full p-3 rounded-md">
                            </div>
                            <div>
                                <label for="q7_1" class="block text-md font-medium text-gray-700 mb-2">5. 您希望项目的交付时间是什么时候？</label>
                                <input type="date" id="q7_1" name="delivery_date" class="form-input w-full p-3 rounded-md">
                                <p class="text-sm text-gray-500 mt-1 italic">*请选择期望的项目完成日期，我们将根据时间安排制定详细的项目计划。</p>
                            </div>
                        </div>
                    </section>

                    <!-- 第三部分：内容构思与表现形式 -->
                    <section>
                        <h2 class="form-section-title text-2xl font-bold mb-6 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                            第三部分：内容构思与表现形式
                        </h2>
                        <div class="space-y-6 bg-white p-6 rounded-lg shadow-sm">
                            <div>
                                <label for="q8" class="block text-md font-medium text-gray-700 mb-2">1. 是否有您特别希望在片中重点呈现的场景或故事？</label>
                                <textarea id="q8" name="key_scenes" rows="4" class="form-textarea w-full p-3 rounded-md"></textarea>
                                <p class="text-sm text-gray-500 mt-1 italic">*案例提示：医生深夜抢救的镜头、与患者互动的温馨片段、科研攻关的场景。</p>
                            </div>
                            <div>
                                <label class="block text-md font-medium text-gray-700 mb-2">2. 对视频风格的偏好：</label>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <label class="flex items-center"><input type="radio" name="video_style" value="documentary" class="form-radio h-4 w-4 mr-2"><span class="text-sm">温情纪实</span></label>
                                    <label class="flex items-center"><input type="radio" name="video_style" value="authoritative" class="form-radio h-4 w-4 mr-2"><span class="text-sm">专业权威</span></label>
                                    <label class="flex items-center"><input type="radio" name="video_style" value="popular_science" class="form-radio h-4 w-4 mr-2"><span class="text-sm">活泼科普</span></label>
                                    <label class="flex items-center"><input type="radio" name="video_style" value="other" class="form-radio h-4 w-4 mr-2"><span class="text-sm">其他</span></label>
                                </div>
                                <input type="text" name="video_style_other" class="form-input w-full p-2 mt-2 rounded-md text-sm" placeholder="请说明其他风格">
                            </div>
                            <div>
                                <label for="q9" class="block text-md font-medium text-gray-700 mb-2">3. 是否有参考过的宣传片案例或视频风格？（可提供链接或说明）</label>
                                <input type="text" id="q9" name="reference_video" class="form-input w-full p-3 rounded-md">
                            </div>
                            <div>
                                <label for="q10" class="block text-md font-medium text-gray-700 mb-2">4. 您希望在视频中加入的专属元素（如院徽、口号、标志性建筑/设备）有哪些？</label>
                                <input type="text" id="q10" name="exclusive_elements" class="form-input w-full p-3 rounded-md">
                            </div>
                        </div>
                    </section>
                    
                    <!-- 第四部分：项目执行信息 -->
                    <section>
                        <h2 class="form-section-title text-2xl font-bold mb-6 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                            第四部分：项目执行信息
                        </h2>
                        <div class="space-y-6 bg-white p-6 rounded-lg shadow-sm">
                            <div>
                                <label for="q11" class="block text-md font-medium text-gray-700 mb-2">1. 项目联系人姓名</label>
                                <input type="text" id="q11" name="contact_name" class="form-input w-full p-3 rounded-md" required>
                            </div>
                            <div>
                                <label for="q12" class="block text-md font-medium text-gray-700 mb-2">2. 联系人职务</label>
                                <input type="text" id="q12" name="contact_position" class="form-input w-full p-3 rounded-md" required>
                            </div>
                            <div>
                                <label for="q13" class="block text-md font-medium text-gray-700 mb-2">3. 联系电话</label>
                                <input type="tel" id="q13" name="contact_phone" class="form-input w-full p-3 rounded-md" required>
                            </div>
                            <div>
                                <label for="q14" class="block text-md font-medium text-gray-700 mb-2">4. 电子邮箱</label>
                                <input type="email" id="q14" name="contact_email" class="form-input w-full p-3 rounded-md" required>
                            </div>
                        </div>
                    </section>
                    
                    <!-- 第五部分：补充说明 -->
                    <section>
                        <h2 class="form-section-title text-2xl font-bold mb-6 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                            第五部分：补充说明
                        </h2>
                        <div class="space-y-6 bg-white p-6 rounded-lg shadow-sm">
                            <div>
                                <label for="q15" class="block text-md font-medium text-gray-700 mb-2">请在此补充任何表单中未覆盖到的重要事项或特殊要求</label>
                                <textarea id="q15" name="additional_notes" rows="6" class="form-textarea w-full p-3 rounded-md" placeholder="例如：特殊的拍摄时间安排、保密要求、特殊设备需求、其他合作方信息等..."></textarea>
                                <p class="text-sm text-gray-500 mt-1 italic">*此部分为选填项，如有任何补充说明请详细描述，我们将认真考虑您的需求。</p>
                            </div>
                        </div>
                    </section>
                    
                    <!-- 提交按钮 -->
                    <div class="flex justify-end pt-6">
                        <button type="submit" class="accent-bg text-white font-bold py-3 px-8 rounded-lg shadow-md hover:opacity-90 transition-opacity submit-button">
                            <span class="button-text">提交问卷</span>
                            <span class="spinner hidden"></span>
                        </button>
                    </div>
                </form>
            </main>


        </div>

        <!-- 底部板块 -->
        <div class="mt-12 space-y-6">
            <!-- 引用语 -->
            <div class="bg-gray-50 p-6 rounded-lg">
                <div class="flex">
                    <div class="w-1 bg-orange-500 mr-4"></div>
                    <div class="flex-1">
                        <blockquote class="text-gray-700 text-lg italic mb-2">
                            "一个好的宣传片,是连接科室与公众情感的桥梁,它讲述的不仅是技术,更是温度。"
                        </blockquote>
                        <cite class="text-gray-500 text-sm">— 资深医疗品牌顾问</cite>
                    </div>
                </div>
            </div>


        </div>
    </div>
    
        <!-- 提交成功后的模态框 -->
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full" style="background-color: #FFDDC1;">
                <svg class="h-6 w-6 accent-color" stroke="currentColor" fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h3 class="text-lg leading-6 font-medium text-gray-900 mt-4">提交成功！</h3>
            <div class="mt-2 px-7 py-3">
                <p class="text-sm text-gray-500">
                    感谢您的填写，我们已收到您的问卷。项目经理将在 1-2 个工作日内与您联系，进行下一步沟通。
                </p>
            </div>
            <div class="mt-4">
                <button id="close-modal" type="button" class="accent-bg text-white font-bold py-2 px-6 rounded-lg hover:opacity-90 transition-opacity">
                    关闭
                </button>
            </div>
        </div>
    </div>



    <script>
        // 错误处理
        window.addEventListener('error', function(e) {
            console.error('JavaScript错误:', e.error);
            alert('页面加载出现问题，请刷新页面重试。错误信息: ' + e.message);
        });

        // 动态设置当前日期
        document.addEventListener('DOMContentLoaded', function() {
            const dateElement = document.getElementById('current-date');
            if (dateElement) {
                const today = new Date();
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const day = String(today.getDate()).padStart(2, '0');
                dateElement.textContent = `${year}-${month}-${day}`;
            }

            // 自动调整textarea高度
            function autoResizeTextarea(textarea) {
                textarea.style.height = 'auto';
                textarea.style.height = textarea.scrollHeight + 'px';
            }

            // 为所有textarea添加自动调整功能
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                // 初始调整
                autoResizeTextarea(textarea);
                
                // 监听输入事件
                textarea.addEventListener('input', function() {
                    autoResizeTextarea(this);
                });
                
                // 监听焦点事件
                textarea.addEventListener('focus', function() {
                    autoResizeTextarea(this);
                });
            });

            const form = document.getElementById('survey-form');
            const modal = document.getElementById('success-modal');
            const closeModalButton = document.getElementById('close-modal');

            if (form) {
                form.addEventListener('submit', function(event) {
                    event.preventDefault(); // 阻止默认提交行为
                    
                    // 显示加载状态
                    const submitButton = form.querySelector('button[type="submit"]');
                    const buttonText = submitButton.querySelector('.button-text');
                    const spinner = submitButton.querySelector('.spinner');
                    const originalText = buttonText.textContent;
                    
                    submitButton.disabled = true;
                    buttonText.textContent = '提交中...';
                    spinner.classList.remove('hidden');
                    form.classList.add('loading');
                    
                    // 收集表单数据
                    const formData = new FormData(form);
                    const data = {};
                    
                    // 处理普通输入和多选框
                    formData.forEach((value, key) => {
                        if (!data[key]) {
                            data[key] = value;
                        } else {
                            if (!Array.isArray(data[key])) {
                                data[key] = [data[key]];
                            }
                            data[key].push(value);
                        }
                    });

                    // 保存到本地存储
                    const timestamp = new Date().toISOString();
                    const submissionId = `survey_${timestamp}`;
                    const submissionData = {
                        id: submissionId,
                        timestamp: timestamp,
                        data: data
                    };
                    
                    // 获取现有提交记录
                    let submissions = JSON.parse(localStorage.getItem('survey_submissions') || '[]');
                    submissions.push(submissionData);
                    localStorage.setItem('survey_submissions', JSON.stringify(submissions));

                    // 更新提交计数
                    updateSubmissionsCount();

                    // 打印数据到控制台
                    console.log("问卷已提交，数据如下：");
                    console.log(JSON.stringify(data, null, 2));
                    console.log("提交ID:", submissionId);

                    // AJAX提交到Netlify Forms
                    fetch("/", {
                        method: "POST",
                        headers: { "Content-Type": "application/x-www-form-urlencoded" },
                        body: new URLSearchParams(formData).toString()
                    })
                    .then(response => {
                        if (response.ok) {
                            console.log('Netlify Forms提交成功');

                            // 立即显示成功提示，并重置表单（以Netlify成功为准）
                            if (modal) {
                                modal.classList.remove('hidden');
                            }
                            form.reset();

                            // Webhook 后台异步发送，失败仅记录日志
                            fetch('https://n8n.wendealai.com/webhook-test/survey', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify(data)
                            }).then(wr => {
                                if (!wr.ok) {
                                    console.error('Webhook提交失败:', wr.status);
                                } else {
                                    console.log('Webhook提交成功');
                                }
                            }).catch(err => {
                                console.error('Webhook提交错误:', err);
                            });
                        } else {
                            throw new Error('Netlify提交失败');
                        }
                    })
                    .catch(error => {
                        console.error('提交错误:', error);
                        alert('Netlify提交失败，请稍后重试。数据已保存到本地。');
                    })
                    .finally(() => {
                        // 恢复提交按钮状态
                        submitButton.disabled = false;
                        buttonText.textContent = originalText;
                        spinner.classList.add('hidden');
                        form.classList.remove('loading');
                    });
                });
            }

            if (closeModalButton && modal) {
                closeModalButton.addEventListener('click', function() {
                    modal.classList.add('hidden');
                    form.reset(); // 关闭时重置表单
                });
            }
            
            // 点击模态框外部区域也可以关闭
            if (modal) {
                modal.addEventListener('click', function(event) {
                    if (event.target === modal) {
                        modal.classList.add('hidden');
                        form.reset();
                    }
                });
            }

            // 更新提交数量显示
            function updateSubmissionsCount() {
                // 记录到控制台
                const submissions = JSON.parse(localStorage.getItem('survey_submissions') || '[]');
                console.log('当前提交数量:', submissions.length);
            }

            // 初始化显示提交数量
            updateSubmissionsCount();
        });
    </script>

</body>
</html>
